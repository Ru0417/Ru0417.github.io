<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>å¯æ„› XO å°é›»è…¦æ£‹</title>
    <style>
        /* ğŸ¨ å¯æ„›é¢¨æ ¼ CSS */
        body {
            font-family: "Noto Sans TC", sans-serif;
            text-align: center;
            background-color: #fce4ec; /* æŸ”å’Œç²‰ç´…èƒŒæ™¯ */
            color: #4a4a4a;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        h1 {
            color: #d81b60; /* å¯æ„›ç²‰è‰²æ¨™é¡Œ */
            margin-bottom: 5px;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);
        }
        #status {
            font-size: 1.2em;
            font-weight: bold;
            color: #880e4f;
            margin-bottom: 15px;
        }

        .board {
            width: 300px;
            height: 300px;
            margin: 20px auto;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 8px; /* å¢åŠ é–“éš™ */
            border-radius: 15px;
            background-color: #ffccbc; /* æ·ºæ©™ç´…æ£‹ç›¤èƒŒæ™¯ */
            padding: 8px;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
        }

        .cell {
            background-color: #fff8e1; /* ç±³ç™½è‰²æ ¼å­ */
            border: 3px solid #f06292; /* ç²‰è‰²é‚Šæ¡† */
            border-radius: 12px;
            font-size: 3em; /* æ”¾å¤§ç¬¦è™Ÿ */
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            /* è®“ç¬¦è™Ÿåœ¨æ ¼å­å…§æœ‰æ·±åº¦ */
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2); 
            line-height: 1;
        }
        
        /* ğŸ¨ å‹•ç•«ï¼šæ»‘é¼ æ‡¸åœæ•ˆæœ */
        .cell:hover:empty {
            background-color: #ffb74d; /* æ©˜è‰²æ‡¸åœæ•ˆæœ */
            transform: scale(1.03);
        }

        /* ğŸ¨ å‹•ç•«ï¼šæ£‹å­æ·¡å…¥ */
        .cell span {
            opacity: 0;
            animation: fadein 0.3s ease-in forwards;
        }
        @keyframes fadein {
            from { opacity: 0; transform: scale(0.5); }
            to { opacity: 1; transform: scale(1); }
        }

        .controls {
            margin-top: 15px;
        }
        #resetBtn {
            padding: 10px 20px;
            border-radius: 20px;
            border: none;
            background-color: #ff8a65; /* çŠç‘šç´…æŒ‰éˆ• */
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        #resetBtn:hover {
            background-color: #ff5722;
            transform: translateY(-2px);
        }
        #resetBtn:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body>
    <main class="container">
        <h1>XO å°é›»è…¦æ£‹</h1>
        <div id="status">ç©å®¶ (X) å…ˆæ‰‹</div> 
        <div id="board" class="board"></div>
        <div class="controls">
            <button id="resetBtn" onclick="resetGame()">é‡é–‹ä¸€å±€</button> 
        </div>
    </main>

    <script>
        // éŠæˆ²ä¸»è®Šæ•¸
        let board = Array(9).fill(null); // æ£‹ç›¤ç‹€æ…‹ï¼š0-8
        let current = 'X'; // ç•¶å‰ç©å®¶ï¼ˆç©å®¶ç‚ºXï¼‰
        let active = true; // æ§åˆ¶éŠæˆ²æ˜¯å¦é€²è¡Œä¸­
        const PLAYER = 'X';
        const AI = 'O';
        
        // æ‰€æœ‰å¯èƒ½çš„ç²å‹çµ„åˆ
        const WIN_COMBOS = [
            [0, 1, 2], [3, 4, 5], [6, 7, 8],
            [0, 3, 6], [1, 4, 7], [2, 5, 8],
            [0, 4, 8], [2, 4, 6]
        ];

        // --- æ ¸å¿ƒéŠæˆ²æµç¨‹ ---

        // åˆå§‹åŒ–æ£‹ç›¤
        function init() {
            const boardEl = document.getElementById('board');
            boardEl.innerHTML = '';
            board = Array(9).fill(null);
            active = true;
            current = PLAYER;
            document.getElementById('status').innerText = 'ç©å®¶ (X) å…ˆæ‰‹';
            
            // å»ºç«‹9å€‹æ ¼å­ä¸¦ç¶å®šäº‹ä»¶
            for (let i = 0; i < 9; i++) {
                const cell = document.createElement('div');
                cell.classList.add('cell');
                cell.dataset.index = i; // ä½¿ç”¨ data å±¬æ€§å­˜å„²ç´¢å¼•
                cell.onclick = () => playerMove(i);
                boardEl.appendChild(cell);
            }
        }

        // ç©å®¶ä¸‹æ£‹
        function playerMove(i) {
            if (!active || board[i] || current !== PLAYER) return;

            board[i] = PLAYER;
            updateBoard();

            if (checkWin(PLAYER)) {
                endGame('ç©å®¶ (X) å‹åˆ©ï¼');
                return;
            } else if (isFull()) {
                endGame('å¹³æ‰‹ï¼');
                return;
            }

            current = AI;
            document.getElementById('status').innerText = 'é›»è…¦æ€è€ƒä¸­...';
            setTimeout(computerMove, 700); // æ¨¡æ“¬é›»è…¦æ€è€ƒæ™‚é–“
        }

        // é›»è…¦AIä¸‹æ£‹é‚è¼¯ (ä½¿ç”¨ Minimax)
        function computerMove() {
            if (!active) return;
            
            const bestMove = findBestMove(board);
            
            if (bestMove !== null) {
                board[bestMove] = AI;
                updateBoard();
            }

            if (checkWin(AI)) {
                endGame('é›»è…¦ (O) å‹åˆ©ï¼');
                return;
            } else if (isFull()) {
                endGame('å¹³æ‰‹ï¼');
                return;
            }

            current = PLAYER;
            document.getElementById('status').innerText = 'è¼ªåˆ°ç©å®¶ (X)';
        }

        // --- Minimax AI æ¼”ç®—æ³• ---

        // çµ‚ç«¯è©•ä¼°å‡½å¼
        function evaluate(currentBoard) {
            // æª¢æŸ¥ AI è´ (+10)
            if (checkWin(AI, currentBoard)) return 10;
            // æª¢æŸ¥ ç©å®¶ è´ (-10)
            if (checkWin(PLAYER, currentBoard)) return -10;
            // å¹³æ‰‹ (0)
            return 0;
        }

        // å–å¾—æ‰€æœ‰ç©ºæ ¼
        function getEmptySpots(currentBoard) {
            return currentBoard.map((val, index) => val === null ? index : null).filter(val => val !== null);
        }

        /**
         * Minimax éè¿´å‡½å¼
         * @param {Array<string|null>} currentBoard æ¨¡æ“¬æ£‹ç›¤
         * @param {string} player ç•¶å‰ Minimax ç¯€é»çš„ç©å®¶ ('X' æˆ– 'O')
         * @returns {number} ç•¶å‰ç‹€æ…‹çš„æœ€ä½³åˆ†æ•¸
         */
        function minimax(currentBoard, player) {
            const score = evaluate(currentBoard);

            // 1. çµ‚ç«¯ç‹€æ…‹æª¢æŸ¥
            if (score === 10 || score === -10) {
                return score;
            }
            if (isFull(currentBoard)) {
                return 0;
            }

            const emptySpots = getEmptySpots(currentBoard);

            if (player === AI) { // AI: Maximize
                let best = -Infinity;
                for (let i of emptySpots) {
                    currentBoard[i] = AI;
                    // éè¿´èª¿ç”¨ Minimaxï¼Œåˆ‡æ›åˆ° PLAYER
                    best = Math.max(best, minimax(currentBoard, PLAYER));
                    currentBoard[i] = null; // æ’¤éŠ·èµ°æ³•
                }
                return best;
            } else { // PLAYER: Minimize
                let best = Infinity;
                for (let i of emptySpots) {
                    currentBoard[i] = PLAYER;
                    // éè¿´èª¿ç”¨ Minimaxï¼Œåˆ‡æ›åˆ° AI
                    best = Math.min(best, minimax(currentBoard, AI));
                    currentBoard[i] = null; // æ’¤éŠ·èµ°æ³•
                }
                return best;
            }
        }

        // æ‰¾åˆ°æœ€ä½³èµ°æ³•
        function findBestMove(currentBoard) {
            let bestVal = -Infinity;
            let bestMove = null;

            const emptySpots = getEmptySpots(currentBoard);

            for (let i of emptySpots) {
                // å˜—è©¦èµ°æ³•
                currentBoard[i] = AI;
                
                // å‘¼å« Minimaxï¼Œæ‰¾åˆ°ç•¶å‰èµ°æ³•çš„è©•åˆ†ã€‚ä¸‹ä¸€å±¤æ˜¯ PLAYER (Minimizer)
                let moveVal = minimax(currentBoard, PLAYER);
                
                // æ’¤éŠ·èµ°æ³•
                currentBoard[i] = null;

                // æ¯”è¼ƒä¸¦æ›´æ–°æœ€ä½³èµ°æ³•
                if (moveVal > bestVal) {
                    bestVal = moveVal;
                    bestMove = i;
                }
            }
            return bestMove;
        }


        // --- è¼”åŠ©å‡½å¼ ---

        // æ›´æ–°ç•«é¢
        function updateBoard() {
            const cells = document.getElementsByClassName('cell');
            for (let i = 0; i < 9; i++) {
                // ç‚ºäº†å‹•ç•«æ•ˆæœï¼Œæˆ‘å€‘åœ¨ cell å…§ä½¿ç”¨ span åŒ…å«ç¬¦è™Ÿ
                if (board[i]) {
                    // æª¢æŸ¥æ˜¯å¦å·²å­˜åœ¨ spanï¼Œé¿å…é‡è¤‡æ·»åŠ 
                    if (!cells[i].querySelector('span')) {
                        const span = document.createElement('span');
                        span.innerText = board[i];
                        cells[i].appendChild(span);
                    }
                } else {
                    cells[i].innerHTML = ''; // æ¸…ç©ºç©ºæ ¼
                }
            }
        }

        /**
         * åˆ¤æ–·å‹åˆ©
         * @param {string} player è¦æª¢æŸ¥çš„ç©å®¶ ('X' æˆ– 'O')
         * @param {Array<string|null>} currentBoard æª¢æŸ¥çš„æ£‹ç›¤ç‹€æ…‹ (é è¨­ç‚ºå…¨åŸŸ board)
         */
        function checkWin(player, currentBoard = board) {
            return WIN_COMBOS.some(([a, b, c]) => 
                currentBoard[a] === player && 
                currentBoard[b] === player && 
                currentBoard[c] === player
            );
        }

        /**
         * åˆ¤æ–·æ˜¯å¦å¹³æ‰‹
         * @param {Array<string|null>} currentBoard æª¢æŸ¥çš„æ£‹ç›¤ç‹€æ…‹ (é è¨­ç‚ºå…¨åŸŸ board)
         */
        function isFull(currentBoard = board) {
            return currentBoard.every(cell => cell !== null);
        }

        // çµæŸéŠæˆ²
        function endGame(message) {
            document.getElementById('status').innerText = message;
            active = false;
        }

        // é‡é–‹ä¸€å±€
        function resetGame() {
            init();
        }

        // åˆå§‹åŒ–
        init();
    </script>
</body>
</html>